---
title: "WinAPI : 저장 & 불러오기"
excerpt: "다이얼로그를 이용한 맵 저장 불러오기"
toc: true
toc_sticky: true
toc_label: "목차"
categories:
  - WinAPI
tags:
  - [CPP, WinAPI]
date: 2021-08-05
breadcrumb: true
---

# 48~50강. 파일 저장 및 불러오기

이전에 해본 맵 만들기의 결과물을 파일의 형태로 저장하고 불러올 수 있도록 해보자.

# 파일 저장 구조 설계

맵 에디터 씬에 파일 저장 및 불러오기에 사용할 키를 먼저 등록한다.

```csharp
GET_SINGLE(Input)->AddKey("Save", 'S', VK_CONTROL);
GET_SINGLE(Input)->AddKey("Load", 'O', VK_CONTROL);
// 조합 키로 등록되어 Ctrl + S, Ctrl + O의 효과를 낸다.

if (KEYDOWN("Save"))
{
	//해당 조합 키를 눌렀을 때 저장이 실행된다.
}
```

다이얼로그를 출력하여 원하는 파일 이름으로 저장할 수 있도록 할 것이다.

다이얼로그는 새로운 윈도우 창을 만드는 것이어서 기존에 존재하는 윈도우 핸들하고 전혀 다른 핸들이다.

프로젝트에서 리소스 추가를 선택해서 다이얼로그를 추가해준다. 해당 다이얼로그는 도구상자의 대화 상자 편집기에서 추가적인 컨트롤 목록이 나오는데 필요한 요소를 추가할 수 있다.

윈도우 프로시져를 이용해 다이얼로그를 열어서 확인을 해야하는데  방법은 크게 두가지 방법이 있다.

1. 모달 방식 : 다이얼로그를 열었을 때 부모 윈도우는 클릭이 불가능하다. (독점 모드)
2. 모달리스 방식 : 다이얼로그를 열었을 때 부모 윈도우도 클릭이 가능하다. (비 독점 모드)

### 다이얼로그 열기

저장 키를 누르게 될때 다이얼로그를 열게된다. DialogBox()를 이용해서 다이얼로그를 열 수 있다.

DialogBox의 인자로  다이얼로그의 ID값이 필요한데 프로젝트의 리소스 헤더에서 확인할 수 있다.

```csharp
DialogBox(WINDOWINSTANCE, MAKEINTRESOURCE(IDD_DIALOG1),
			WINDOWHANDLE, MapEditScene::DlgProc);
//인자로 윈도우 인스턴스, 다이얼로그 아이디 값, 윈도우 핸들, 다이얼로그 프로시져가 필요하다.
```

다이얼로그의 작동을 위해서는 DlgProc에 메세지를 만들어줘야 한다.

```csharp
INT_PTR MapEditScene::DlgProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)
{
	switch (message)
	{
	case WM_INITDIALOG:
		return TRUE;
	case WM_COMMAND:
		switch (LOWORD(wParam))
		{
		case IDOK:
			// Edit Box에서 문자열을 얻어온다.
			memset(m_strText, 0, sizeof(wchar_t) * MAX_PATH);
			GetDlgItemText(hWnd, IDC_EDIT1, m_strText, MAX_PATH);
		case IDCANCEL:
			EndDialog(hWnd, IDOK); // 다이얼로그 종료
			return TRUE;
		}
		return FALSE;
	}
	return FALSE;
}
```